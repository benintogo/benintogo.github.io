<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Filter Taxonomies within Map View</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 25%;
            /* Adjust this to match the initial width of the sidebar */
            transition: left 0s;
            /* Smooth transition for map adjustment */
        }

        #sidebar {
            padding-right: 10px;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            width: 25%;
            /* Adjust the initial width of the sidebar here */
            overflow-x: hidden;
            /* Prevents horizontal scroll on the sidebar */
            z-index: 2;
            /* Ensures that the sidebar is above the map */
            transition: width 0s;
            /* Smooth transition for sidebar width */
        }

        .map-overlay input {
            display: block;
            border: none;
            width: 100%;
            border-radius: 3px;
            padding: 10px;
            margin: 0;
            box-sizing: border-box;
        }

        .map-overlay .listing {
            overflow: auto;
            max-height: 100%;
        }

        .map-overlay .listing a {
            display: block;
            padding: 5px 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            color: #404;
            text-decoration: none;
        }

        .map-overlay .listing a:last-child {
            border: none;
        }

        .map-overlay .listing a:hover {
            background: #f0f0f0;
        }

        .mapboxgl-popup-content {
            scroll-behavior: auto;
            overflow: auto;
            /* Adjust content overflow as needed */
            resize: both;
            /* Enable resizing in both directions */
            min-width: 200px;
            /* Minimum width */
            min-height: 200px;
            /* Minimum height */
            max-width: none;
            /* Remove maximum width restriction */
            width: 300px;
            height: 50vh;
            max-height: 80vh;
            /* Remove maximum width restriction */
            overflow-y: auto;
            overflow-x: hidden;
        }


        @media only screen and (max-width: 600px) {

            /* Adjust max-width as needed */
            .mapboxgl-popup {
                display: flex;
                flex-direction: column;
                overflow: hidden;
                /* Hide overflow */
                width: 97%;
                /* Or any other width you prefer */
                max-width: 350px;
                /* This can help if there is a max-width set by default */
            }

            .mapboxgl-popup-content {
                width: 97%;
                /* Or any other width you prefer */
                max-width: 350px;
                /* This can help if there is a max-width set by default */
                height: 370px;
                /* Adjust if a fixed height is needed */
                font-size: 10px;
                /* Adjust text size as needed */
                overflow-y: auto;
                /* Allows scrolling within the popup */
                overflow-x: hidden;
                padding-top: 0;
                /* Remove padding from the top */
                padding-left: 0;
                /* Remove padding from the left */
                border: none;
                /* Replace #ccc with the color of your choice */
            }

            .mapboxgl-popup .mapboxgl-popup-tip {
                display: none;
                /* Optionally hide the tip arrow on smaller screens */
            }

            /* Adjustments to internal popup content */
            .popup-flex-container,
            .search-bar-container,
            .popup-content-details {
                padding: 5px;
                /* Consistent padding for mobile */
            }

            .collapsible-header,
            .result-item {
                font-size: 10px;
                /* Smaller font size for titles and results */
            }

            /* Adjust button sizes */
            .expand-all-btn,
            .collapse-all-btn {
                padding: 5px;
                /* Adjust padding for buttons */
                font-size: 10px;
                /* Smaller text on buttons */
                width: 97%;
                /* Or any other width you prefer */
                max-width: 350px;
                /* Maximum width of the search bar */
                margin: 0 2px;
                /* Add some margin between buttons */
            }

            /* Adjust input field size */
            .popup-flex-container input[type="text"] {
                padding: 5px;
                /* Adjust padding for the input field */
                margin-bottom: 5px;
                /* Margin below the search bar */
                width: 97%;
                /* Or any other width you prefer */
                max-width: 350px;
                /* Maximum width of the search bar */
                font-size: 10px;
                /* Adjust font size if necessary */
                height: 30px;
                /* Adjust height of the search bar if needed */
                border: 1px solid #ccc;
                /* Same color as the popup border */
            }
        }


        .popup-flex-container {
            display: flex;
            flex-direction: column;
            /* height: 400px; */
            /* Set the initial fixed height */
            position: relative;
            scroll-behavior: auto;
            max-width: none;
            background-color: white;
        }

        .popup-flex-container input[type="text"] {
            flex: 0 0 auto;
            width: 100%;
            padding: 5px;
            margin-bottom: 15px;
            margin-top: 15px;
            box-sizing: border-box;
            scroll-behavior: auto;
            background-color: white;
        }

        .popup-content-details {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: auto;
            padding: 10px;
            padding-top: 0px;
            /* Add padding-top equal to the height of the search bar to prevent content from hiding under it */
        }

        .search-container {
            padding: 10px;
            background-color: white;
            /* Ensures the background is solid */
            z-index: 100;
            /* Ensures that the search bar is above the content. Adjust if necessary. */
            position: sticky;
            top: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            /* Adds shadow for depth */
        }

        .highlighted {
            background-color: yellow;
        }


        .feature-filter {
            padding: 10px;
        }

        #feature-listing {
            overflow: auto;
        }

        .collapsible {
            margin-bottom: 5px;
        }

        .collapsible-header {
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ddd;
            font-weight: bold;
        }

        .collapsible-content {
            padding: 0 10px;
            display: none;
            overflow: hidden;
            border: 1px solid #ddd;
            border-top: none;
        }

        .collapsible-arrow {
            float: right;
        }

        #filter-dropdown {
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            font-weight: bold;
            margin: 10px;
            padding: 5px;
            width: calc(100% - 20px);
        }

        #results-container {
            margin: 10px;
            padding: 5px;
            height: calc(100% - 50px);
            /* Adjust based on available space */
            overflow-y: auto;
            text-align: justify;
        }

        .result-item {
            display: flex;
            justify-content: flex-start;
            padding: 5px;
            /* Consistent padding on all sides */
            border-bottom: 1px solid #eaeaea;
            /* Consistent border for all items */
            background-color: #f9f9f9;
            /* Consistent background for all items */
            margin-bottom: 5px;
            /* Consistent margin for all items */
        }

        .result-item a {
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            display: inline-block;
            max-width: calc(100% - 10px);
            /* Adjust max-width considering the padding */
            margin: 0 5px;
            /* Add margin to the links if needed */
        }

        .country-name {
            /* Styling for the country name */
            font-weight: bold;
            /* example style */
            margin-right: 8px;
            /* Adjust the value as needed */
        }

        .map-overlay {
            background-color: #fff;
            /* Match popup background */
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            border-left: 1px solid #ddd;
            /* Existing left border */
            border-right: 1px solid #ddd;
            /* Add right border */
            padding: 10px;
        }

        .drag-handle {
            right: 0;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 25.8%;
            /* Adjust this to match the initial width of the sidebar */
            width: 10px;
            /* Width of the draggable area */
            cursor: ew-resize;
            z-index: 3;
            /* Ensures that the drag handle is above the sidebar and map */
        }

        .drag-handle::after {
            content: '⋮⋮';
            /* Vertical ellipsis or another symbol for the handle */
            display: block;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            color: #666;
            line-height: 1;
        }


        #filter-dropdown,
        #results-container {
            background-color: #efefef;
            /* Subtle background color */
            border-radius: 3px;
            /* Rounded corners like in popup */
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
            /* Shadow for depth, similar to popup */
            margin: 10px;
            padding: 1px;
            width: calc(100% - 23px);
            /* Full width with padding */
        }

        .country-details {
            text-align: justify;
            flex-grow: 1;
            overflow-wrap: break-word;
            /* Allows unbreakable words to be broken */
            word-wrap: break-word;
            /* Ensures that words can be broken and wrapped onto the next line */
            word-break: break-word;
            /* Use this if you want to ensure breaking at the end of the line for long words or URLs */
            /* This will make the details fill up the remaining space */
            /* Adjust the width as necessary */
        }

        .collapsible-header,
        .collapsible-content {
            background-color: #f9f9f9;
            /* Consistent background with result items */
            border-color: #eaeaea;
            /* Light border color */
        }

        .objectives ul {
            list-style-type: disc;
            /* This adds the bullet point */
            padding-left: 20px;
            /* This indents the list */
        }

        .objectives li {
            margin-bottom: 10px;
            /* This adds space between list items */
            text-align: left;
            /* Ensures text is aligned to the left */
        }

        .popup-resize-handle {
            position: absolute;
            top: 0.5;
            /* Position it at the top of the popup */
            right: 0;
            /* Position it at the right of the popup */
            width: 20px;
            height: 20px;
            cursor: nwse-resize;
            background: rgba(0, 0, 0, 0.3);
            /* Visible handle */
        }

        .mapboxgl-popup-content {
            padding-top: 0px;
            /* Make sure this is at least as tall as the resize handle */
            padding-right: 20px;
            /* Make sure this is at least as wide as the resize handle */
            background-color: white;
            /* Or any other color that fits the design */
            overflow: auto;
            /* Adjust content overflow as needed */
            resize: both;
            /* Enable resizing in both directions */
            min-width: 200px;
            /* Minimum width */
            min-height: 100px;
            /* Minimum height */
            max-width: none;
            /* Remove maximum width restriction */
            overflow-x: hidden;
            word-wrap: break-word;
            /* This ensures that long words do not cause horizontal overflow */
            overflow-wrap: break-word;
        }

        .expand-all-btn,
        .collapse-all-btn {
            margin: 5px;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        .expand-all-btn:hover,
        .collapse-all-btn:hover {
            background-color: #0056b3;
        }

        .popup-search-container {
            position: sticky;
            top: 0;
            z-index: 2;
            /* Ensures it stays above other content */
            background-color: white;
            /* Or any color that fits your design */
            padding: 10px;
            /* Adjust padding as needed */
            border-bottom: 1px solid #ccc;
            /* Optional: adds a subtle line to distinguish the search bar */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            /* Optional: adds shadow for depth */
        }
    </style>
</head>

<body>

    <div class="map-overlay" id="sidebar">
        <div class="update-info">
            Details as of: 28.03.2024
        </div>
        <select id="filter-dropdown">
            <option value="">Select a Category</option>
            <option value="name">Taxonomy</option>
            <option value="yearinitiated">Year Initiated</option>
            <option value="developer">Developer</option>
            <option value="mandatedinlaworvoluntary">Mandated?</option>
            <option value="Purpose">Type</option>
            <option value="objective">Objectives</option>
            <option value="linkpolicyobjectives">Objectives of Interest</option>
            <!--<option value="Sectorclassification">Sector Classification</option>-->
            <option value="approachtoeligibility">Approach to Eligibility</option>
            <option value="sectorscovered">Sectors Covered</option>
            <option value="Socialobjectivessafeguards">Social Objectives / Safeguards</option>
            <option value="DonosignificantharmDNHS">Do No Significant Harm (DNSH)</option>
            <!--<option value="mostrecentupdate">Most Recent Update</option>-->
            <option value="Intendedtobeinteroperable">Intended to be Interoperable</option>
            <!--<option value="Biodiversity">Biodiversity</option>-->
            <option value="MemberofIPFS">Member of the IPSF</option>
            <option value="link">Taxonomy Source</option>
            <option value="Additionalguidance">Additional Guidance</option>
            <option value="otherusefuldocuments">Other Useful Documents</option>
        </select>
        <div id="results-container"></div>
    </div>

    <div id="drag-handle" class="drag-handle"></div>

    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoianVuaW9yYW5hbHlzdDEiLCJhIjoiY2xranA1eHV5MHlpczNja2dieDlkZzJiciJ9.CN5Qa40PM2IMpwlyBAFTVA';

        const isMobile = window.innerWidth < 600;

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [0, 0],
            maxZoom: 5,
            minZoom: -1,
            zoom: isMobile ? -1 : 2 // Use minZoom for mobile, otherwise use 2

        });

        function renderListings(features) {
            listingEl.innerHTML = '';
            if (features.length) {
                const listContainer = document.createElement('ul');
                for (const feature of features) {
                    const listItem = document.createElement('li');
                    const itemLink = document.createElement('a');
                    const taxonomy = esgTaxonomies.find(taxonomy => taxonomy.name === feature.properties.name);

                    itemLink.href = taxonomy.link; // Use the link from the taxonomy data
                    itemLink.target = '_blank';
                    itemLink.textContent = taxonomy.country; // Display the country

                    listItem.appendChild(itemLink);
                    listContainer.appendChild(listItem);
                }
                listingEl.appendChild(listContainer);
            }
        }

        function convertUrlsToLinks(text) {
            const urlRegex = /(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
            return text.replace(urlRegex, function (url) {
                return '<a href="' + url + '" target="_blank">' + url + '</a>';
            });
        }

        document.getElementById('filter-dropdown').addEventListener('change', function () {
            const selectedCategory = this.value;
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.innerHTML = ''; // Clear previous results

            esgTaxonomies.forEach(taxonomy => {
                if (taxonomy[selectedCategory]) {
                    const resultItem = document.createElement('div');
                    resultItem.classList.add('result-item');

                    const countryNameSpan = document.createElement('span');
                    countryNameSpan.classList.add('country-name');
                    countryNameSpan.textContent = taxonomy.country + ':';

                    // Determine if the content starts with 'http://' or 'https://'
                    const detailElement = document.createElement('div');
                    detailElement.classList.add('country-details');

                    // Use innerHTML to parse HTML string and convert URLs to links
                    detailElement.innerHTML = convertUrlsToLinks(taxonomy[selectedCategory]);

                    // Append the new elements to the resultItem, then to the resultsContainer
                    resultItem.appendChild(countryNameSpan);
                    resultItem.appendChild(detailElement);
                    resultsContainer.appendChild(resultItem);
                }
            });
        });

        const dragHandle = document.getElementById('drag-handle');
        const sidebar = document.getElementById('sidebar');

        let isDragging = false;

        // ... (rest of your existing script before the drag functionality)

        // Function to handle the dragging for both touch and mouse events
        function handleDrag(event) {
            // Determine the type of event
            const xPosition = event.type.includes('touch') ? event.touches[0].clientX : event.clientX;

            // Update the layout based on the event's X position
            updateLayout(xPosition);
        }

        // Add this function to update sidebar and map layout
        function updateLayout(sidebarWidth) {
            const sidebar = document.getElementById('sidebar');
            const mapContainer = document.getElementById('map');

            // Update sidebar width
            sidebar.style.width = `${sidebarWidth}px`;

            // Update drag handle position
            const dragHandle = document.getElementById('drag-handle');
            dragHandle.style.left = `${sidebarWidth}px`;

            // Update map container left margin
            mapContainer.style.left = `${sidebarWidth}px`;

            // Ensure the map adjusts to the new layout
            map.resize(); // Adjust the map size
        }

        // Touch event listeners START
        document.getElementById('drag-handle').addEventListener('touchstart', function (event) {
            isDragging = true;
            // Prevent the default touch behavior like scrolling
            event.preventDefault();
        }, { passive: false });

        document.addEventListener('touchmove', function (event) {
            if (isDragging) {
                handleDrag(event); // Call the handle drag function
                event.preventDefault(); // Prevent scrolling during drag
            }
        }, { passive: false });

        document.addEventListener('touchend', function () {
            isDragging = false;
        });
        // Touch event listeners END


        dragHandle.addEventListener('mousedown', function (e) {
            // Start dragging
            isDragging = true;
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
            e.preventDefault(); // Prevent text selection during drag
        });

        function onMouseUp() {
            // Stop dragging
            isDragging = false;
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
        }

        function updateLayout(xPosition) {
            const sidebarWidth = xPosition;
            const mapContainer = document.getElementById('map');

            // Ensure the sidebar width does not exceed the window boundaries
            const maxSidebarWidth = window.innerWidth - 50; // Keep some space for the map view
            const newSidebarWidth = Math.min(window.innerWidth - 50, Math.max(xPosition, 50)); // Adjust this to your minimum and maximum sidebar width

            sidebar.style.width = `${newSidebarWidth}px`;
            dragHandle.style.left = `${newSidebarWidth}px`;
            mapContainer.style.left = `${newSidebarWidth}px`;

            // Ensure the map adjusts to the new layout
            map.resize(); // Adjust the map size
        }


        function onMouseMove(e) {
            if (!isDragging) return;
            updateLayout(e.clientX);

            const sidebarWidth = e.clientX; // Get the new width based on the cursor position
            const maxWidth = window.innerWidth; // Get the total width of the window

            // Calculate the new width for the map container
            const mapWidth = maxWidth - sidebarWidth;

            // Update sidebar width
            sidebar.style.width = `${sidebarWidth}px`;

            // Update map container width
            const mapContainer = document.getElementById('map');
            mapContainer.style.width = `${mapWidth}px`;

            // Adjust the map view to the new container size
            map.resize();
        }

        function makePopupDraggable(popupElement) {
            const popupResizeHandle = document.createElement('div');
            popupResizeHandle.className = 'popup-resize-handle';
            popupElement.appendChild(popupResizeHandle);

            let isResizingPopup = false;
            let startX, startY, startWidth, startHeight;

            const startResizingPopup = (e) => {
                isResizingPopup = true;
                startX = e.clientX;
                startY = e.clientY;
                startWidth = parseInt(document.defaultView.getComputedStyle(popupElement).width, 10);
                startHeight = parseInt(document.defaultView.getComputedStyle(popupElement).height, 10);
                e.preventDefault(); // Prevent default dragging behavior
            };

            const resizePopup = (e) => {
                if (!isResizingPopup) return;

                let width = startWidth + e.clientX - startX;
                let height = startHeight + e.clientY - startY;

                // Set minimum size constraints
                width = Math.max(width, 1000); // Adjust minimum width as needed
                height = Math.max(height, 400);

                // Update the size of the popup
                popupElement.style.width = `${width}px`;
                popupElement.style.height = `${height}px`;
            };

            const stopResizingPopup = () => {
                isResizingPopup = true;
            };

            popupResizeHandle.addEventListener('mousedown', startResizingPopup);
            document.addEventListener('mousemove', resizePopup);
            document.addEventListener('mouseup', stopResizingPopup);
        }

        function normalize(string) {
            return string.trim().toLowerCase();
        }
        function featureToGeoJSON(taxonomy) {
            return {
                'type': 'Feature',
                'properties': {
                    'name': taxonomy.name,
                    'link': taxonomy.link
                },
                'geometry': {
                    'type': 'Point',
                    'coordinates': [taxonomy.longitude, taxonomy.latitude]
                }
            };
        }

        // Function to escape special characters for regex
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Function to highlight search terms in text
        function highlightText(text, term) {
            if (!term) return text; // No term to highlight
            const escapedTerm = escapeRegExp(term);
            const regex = new RegExp(`(${escapedTerm})`, 'gi');
            return text.replace(regex, `<mark class="highlight">$1</mark>`);
        }

        function filterPopupContent(searchValue, popupContent) {
            // Apply highlighting to all text elements within the popup content, including collapsible sections
            const textElements = popupContent.querySelectorAll('.popup-text, .collapsible-content');

            textElements.forEach(element => {
                const text = element.textContent || element.innerText;
                // If a search term is provided, highlight it; otherwise, reset to the original text
                element.innerHTML = searchValue ? highlightText(text, searchValue) : text;
            });
        }

        document.addEventListener('input', function (event) {
            if (event.target.type === 'text') {
                filterPopupContent(event.target);
            }
        });

        function PopupContent(taxonomy) {
            const popupContent = document.createElement('div');
            // Generate popup innerHTML using taxonomy data
            // popupContent.innerHTML = ...

            // Return the fully constructed popup content element
            return popupContent;
        }

        // Centralized function to toggle display of collapsible content
        function toggleCollapsibleContent(content, show) {
            content.style.display = show ? 'block' : 'none';
            // Update arrow symbol if you have an arrow indicator in your design
        }
        
        const esgTaxonomies = [
            {
                latitude: 4.624335,
                longitude: -74.063644,
                name: 'Taxonomía Verde de Colombia',
                yearinitiated: '2022',
                developer: 'Government of Colombia: The Colombian Superintendency of Finance (SFC), the Ministry of finance (MHCP), The National Planning Department (DNP), the Department of Statistics of Colombia (DANE) and the Ministry of Environment and Sustainable Development (MADS) oversaw the taxonomy development process.',
                mandatedinlaworvoluntary: 'The taxonomy is voluntary and has no legal status. <br> <br> However, there are regulations in place to support its implementation, although these do not impose specific disclosure obligations.  The SFC has issued external circulars that encourage the use of the taxonomy in labelling of green bonds, ESG portfolios and voluntary labelling of pension funds.',
                Purpose: 'Green: Yes <br> <br> Transition: No <br> <br> Ineligible: No',
                objective: 'The main objective is to make a substantial contribution to climate change mitigation, followed by climate change adaptation, ecosystem and biodiversity conservation and water management, soil management,circular economy and pollution prevention and control.',
                linkpolicyobjectives: 'Paris Agreement: Yes <br> <br> Regional Framework: - <br> <br> National Strategies: -',
                approachtoeligibility: 'The Colombian taxonomy uses a pass-list and criteria approach depending on the sector. A list of eligible activities is included for each sector which is typically dependent on its components meeting certain thresholds and criteria.',
                sectorscovered: 'The Colombian taxonomy covers 10 sectors, 47 activities/assets and 11 further activities that derive from three land use sectors which have environmental objectives other than climate change mitigation. 7  sectors for improvement are covered including, Construction, Energy, Transport, Water supply and treatment, Waste, Management and emissions capture, Manufacturing, Information and communication. An additional 3 economic sectors are covered including Livestock, Agriculture, and Forestry.',
                Socialobjectivessafeguards: 'The taxonomy includes six social objectives that must not be violated in order for an activity to be eligible. These relate to 1) the evaluation and managements of environmental and social risks and impacts, 2) working and labor conditions, 3) community health and safety, 4) land acquisition and forced resettlement, 5) indigenous peoples, and 6) cultural heritage',
                DonosignificantharmDNHS: 'Yes <br> <br> Activities must comply with the principle of Do No Significant Harm to any of the environmental or social objectives.',
                Intendedtobeinteroperable: 'Yes',
                MemberofIPFS: 'No',
                link: 'https://www.taxonomiaverde.gov.co/webcenter/portal/TaxonomaVerde',
                Additionalguidance: 'The only official regulatory framework for the adoption of the Colombian Green Taxonomy is the SFC’s External Circular 005 of 20223 which provides instructions for adoption. It allows entities supervised by the SFC the option of using the taxonomy for various purposes, including identifying financing and investment opportunities for supporting the transition to a sustainable economy, measuring portfolio alignment with green assets and activities, structuring green products and solutions, and enhancing disclosure and transparency practices. The external circular includes three annexes specifying: the use of the taxonomy for investment portfolios, green bond issuers, and voluntary pension funds. <br> <br> https://www.cerlatam.com/normatividad/superfinanciera-circular-externa-005-de-2022/#:~:text=La%20SuperFinanciera%20',
                otherusefuldocuments: '• CE 28, 2020 - Green Bonds <br> • CE 08, 2021 - ESG Integration for Voluntary Pension Funds <br> • CE 31, 2021 – ESG and Climate Disclosure Regulation for Issuers <br> • PCE 2022 - Sustainability Linked Bonds <br> <br> The following report provides a helpful comparison between the EU and Colombian Taxonomy provided by the Climate Bond Institute: <br> <br> https://www.climatebonds.net/resources/reports/comparison-study-between-colombian-and-eu-taxonomies',
                country: 'Colombia'
            },
            {
                latitude: 50.85045,
                longitude: 4.34878,
                name: 'European Union Taxonomy for Sustainable Activities',
                link: 'https://ec.europa.eu/sustainable-finance-taxonomy/taxonomy-compass/the-compass',
                yearinitiated: '2020',
                mandatedinlaworvoluntary: 'Mandatory. <br> <br> The taxonomy includes mandatory disclosure obligations on some companies and investors, requiring them to disclose their share of Taxonomy-aligned activities. Nevertheless, the EU Taxonomy is not a mandatory list of economic activities for investors to invest in. Nor does it set mandatory requirements on environmental performance for companies or for financial products. Investors are free to choose what to invest in. However, it is expected that over time, the EU Taxonomy will be an enabler of change and encourage a transition towards sustainability.',
                developer: 'The Technical Expert Group on Sustainable Finance (TEG), Member States Expert Group on Sustainable Finance,  Platform on Sustainable Finance <br> <br> The TEG commenced its work in July 2018. Its 35 members from civil society, academia, business and the finance sector, as well as additional members and observers from EU and international public bodies work both through formal plenaries and subgroup meetings for each workstream. To allow it to conclude its technical work and retain the expertise before the future Platform on sustainable finance is set up, the mandate of the TEG was extended until 30 September 2020 following which it was replaced by the Platform on Sustainable Finance. <br> <br> The European Commission adopted its “Action Plan on Financing Sustainable Growth” on 8 March 2018 which proposed concrete actions that will help achieve the Sustainable Development Goals and the objectives set in the Paris Agreement on Climate Change drawing on the recommendations of the High-Level Expert Group on Sustainable Finance. In its Action Plan, the European Commission has called on other players, such as EU Member States, to support implementing sustainable finance actions and promote the transformation in their territories. For this purpose, the European Commission is creating a dedicated EU Member States expert group on sustainable finance.',
                objective: 'The Taxonomy outlines six key environmental objectives: <br> Addressing climate change by mitigating its impact. <br> Adapting to the challenges posed by climate change. <br> Promoting sustainable management and protection of water and marine resources. <br> Encouraging the shift towards a circular economy. <br> Preventing and controlling pollution. <br> Safeguarding and rejuvenating biodiversity and ecosystems.',
                linkpolicyobjectives: 'Paris Agreement: Yes <br> <br> Regional Frameworks: Yes, (in principal) <br> <br> National Strategies: -',
                approachtoeligibility: 'N/A',
                sectorscovered: 'Activities: 94 activities or assets. <br> <br> Sectors: Construction, infrastructure and real estate, Consumer products, Credit institutions, Health, biotechnology and chemicals, Insurance undertakings, Manufacturing, Mining and quarrying, Mobility - vehicle manufacturing and transport, Oil and gas, Power and Utilities.',
                Intendedtobeinteroperable: 'Yes',
                Purpose: 'Green: Yes <br> <br> Transition: No <br> <br> Ineligible: No',
                DonosignificantharmDNHS: 'Yes <br> <br> For an activity pursuing one or more of the six objectives to qualify as sustainable it cannot cause significant harm to any of the other Taxonomy objectives. For each activity, the TSC lay out thresholds to define compliance with do no significant harm.',
                Socialobjectivessafeguards: 'No',
                Additionalguidance: 'For further guidance on  TSC Notices the Commission sets out draft responses to FAQs on TSCs for the environmental objectives of climate change mitigation and climate change adaptation, contained in the Climate Delegated Act <br> <br> Interpretation and Guidance provided: <br> <br> On 20 October 2023, the following Commission notices regarding interpretation and implementation of certain legal provisions under the Taxonomy Regulation were published in the Official Journal (OJ): <br> The Climate Delegated Act Notice sets out responses to FAQs “on the interpretation and implementation of certain legal provisions of the EU Taxonomy Climate Delegated Act establishing technical screening criteria for economic activities that contribute substantially to climate change mitigation or climate change adaptation and do no significant harm to other environmental objective”. <br> <br>Here the link:<br> https://gbr01.safelinks.protection.outlook.com/?url=https%3A%2F%2Feur-lex.europa.eu%2Flegal-content%2FEN%2FTXT%2FPDF%2F%3Furi%3DOJ%3AC_202300267&data=05%7C01%7CMBDHub%40simmons-simmons.com%7C2089c3da5b2e45d2591b08dbd3ac36d5%7C9c0035ef4799443f8b14c5d60303e8cd%7C0%7C0%7C638336508820094210%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=v602G0uFwizbE3tUorBVWCyLhRrE8LirvWl09aZNo6U%3D&reserved=0 <br> <br> The Disclosures Delegated Act Notice sets out responses to FAQs “on the interpretation and implementation of certain legal provisions of the Disclosures Delegated Act under Article 8 of EU Taxonomy Regulation on the reporting of Taxonomy-eligible and Taxonomy-aligned economic activities and assets”. <br> <br> On 15 June 2023, the Commission published a Notice (the Notice) as part of its ESG package) that deals with “the interpretation and implementation of certain legal provisions of the EU Taxonomy Regulation and links to the Sustainable Finance Disclosure Regulation.” The Notice considers the following questions and issues: <br> <br> • Can Taxonomy-aligned investments qualify as ‘sustainable investment’ under the SFDR? <br> <br> • What is the role of minimum safeguards in the Taxonomy Regulation? <br> <br> • How are minimum safeguards defined under Article 18 of the Taxonomy Regulation? <br> <br> • Key expectations for undertakings under Article 18 of the Taxonomy Regulation. <br> <br> Here a link to the note:<br> https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:52023XC0616 <br> <br> In addition, there is further guidance provided in the following: <br> <br> • A Commission staff document, FAQ: What is the EU Taxonomy Article 8 delegated act and how will it work in practice?; <br> <br> • A Commission staff document, FAQs: How should financial and non-financial undertakings report Taxonomy-eligible economic activities and assets in accordance with the Disclosures Delegated Act (updated January 2022); and <br> <br> • A Commission Notice (published 6 October 2022) on the interpretation of certain legal provisions of the Disclosures Delegated Act on the reporting of Taxonomy-eligible economic activities. <br> <br> Finally, there is also the following the  Disclosures Notice  with FAQ on the Article 8 Disclosure which are set out in the Disclosures Delegated Act – it is likely that much of this disclosure notice will be impacted by the review of SFDR (currently underway) so this notice may decline in its relevance. Here the link: <br> https://ec.europa.eu/finance/docs/law/221219-draft-commission-notice-disclosures-delegated-act-article-8.pdf',
                otherusefuldocuments: 'https://ec.europa.eu/sustainable-finance-taxonomy/<br> <br> The EU taxonomy navigator offers four tools that will help you navigate the EU taxonomy: <br> <br> 1. EU taxonomy compass: a visual representation of sectors, activities and criteria included in the EU Taxonomy delegated acts <br> <br> 2. EU taxonomy calculator: a step-by-step guide on reporting obligations <br> <br> 3. FAQs repository: an overview of questions and answers on the EU taxonomy and its delegated acts <br> <br> 4. EU taxonomy user guide: a guidance document on the Taxonomy for non-experts <br> <br> OTHER - Future work on improving the usability of the taxonomy: A report by the Platform on Sustainable Finance recommendations on data and usability of the EU taxonomy (europa.eu) <br> <br> https://finance.ec.europa.eu/system/files/2022-10/221011-sustainable-finance-platform-finance-report-usability_en_1.pdf',
                MemberofIPFS: 'Yes <br> <br> The European Union was among the founding members.  They are comparing efforts with the CBI with a view to enhance interoperability, convergence is considered too challenging at present.',
                country: 'EU'
            },
            {
                latitude: -6.200000,
                longitude: 106.816666,
                name: 'ASEAN Taxonomy version 1',
                link: 'https://asean.org/wp-content/uploads/2021/11/ASEAN-Taxonomy.pdf',
                yearinitiated: '2010',
                mostrecentupdate: '27-03-2024: ASEAN taxonomy board releases ASEAN taxonomy for sustainable finance - version 3 for transportation and construction sectors',
                mandatedinlaworvoluntary: '-',
                developer: 'ASEAN Capital Markets Forum (ACMF), the ASEAN Insurance Regulators Meeting (AIRM), the ASEAN Senior Level Committee on Financial Integration (SLC), and the ASEAN Working Committee on Capital Market Development (WC-CMD).',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Corporations, Financial Service providers, Investment Managers, Asset Owners (Other), Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Voluntary, Taxonomy.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: 'https://www.sc.com.my/resources/media/media-release/asean-taxonomy-board-releases-asean-taxonomy-for-sustainable-finance-version-3-for-transportation-and-construction-sectors',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'ASEAN'
            },
            {
                latitude: 23.685,
                longitude: 90.3563,
                name: 'Sustainable Finance Policy for Banks and Financial Institutions',
                link: 'https://www.greenfinanceplatform.org/policies-and-regulations/sustainable-finance-policy',
                yearinitiated: '2017',
                mostrecentupdate: '2020 <br> <br> The policy includes Sustainable Finance Taxonomy along with a country perspective Green Taxonomy. The Green Finance and the Sustainable Linked Finance taxonomies together comprise the Sustainable Finance Taxonomy. Comprehensive lists of green products/projects/initiatives and identical areas of sustainable linked finance have been included in the policy. This policy provides clarity and guidance to identify green and Sustainable Linked Finance.',
                mandatedinlaworvoluntary: '-',
                developer: 'Bangladesh Bank (BB)',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Financial Service providers, Investment Managers, Asset Owners (Other), Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Voluntary, Taxonomy.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: 'https://documents1.worldbank.org/curated/en/953011593410423487/pdf/Developing-a-National-Green-Taxonomy-A-World-Bank-Guide.pdf',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'Bangladesh'
            },
            {
                latitude: 39.916668,
                longitude: 116.383331,
                name: 'Green Bond Endorsed-Projects Catalogue and Green Industry Guidance Catalogue',
                link: 'http://www.pbc.gov.cn/goutongjiaoliu/113456/113469/4236341/index.html',
                yearinitiated: '2015 and 2019',
                mostrecentupdate: '2018<br> <br> This revised catalogue unifies domestic standards on green bonds and green projects. Aiming to be more aligned with international standards and Chinas carbon neutrality goal, it removes clean use of coal and other fossil energy sources and adopts a do no significant harm principle. <br> <br> Green Industry Guidance Catalogue: The guidance is meant to enact policies to strengthen green industry development, and combine catalogue with investment, pricing, and financial policies to improve catalogue practicality. It covers 6 main industrial sectors: energy conservation and environmental protection, clean production, clean energy, ecological environment, green upgrade of infrastructure and green service. Clean coal is still in this version.',
                mandatedinlaworvoluntary: '...',
                developer: '2015: Peoples Bank of China, National Development and Reform Commission, and the China Securities Regulatory Commission. <br> <br>2019: National Development and Reform Commission, Ministry of Industry and Information Technology, Ministry of Natural Resources, Ministry of Ecology and Environment, Ministry of Housing and Urban-Rural Development, Peoples Bank of China, National Energy Administration.',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Corporations, Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Mandatory (including comply or explain), Taxonomy.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: '-',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'China'
            },
            {
                latitude: 51.1799,
                longitude: 71.4467,
                name: 'Concept on introduction and development of green finance instruments and principles',
                link: 'https://aifc.kz/en/news/concept-on-introduction-and-development-of-green-finance-instruments-and-principles',
                yearinitiated: '2017',
                mostrecentupdate: 'The most recent roadmap sets out sustainable finance ambitions - including the development of a national taxonomy.',
                mandatedinlaworvoluntary: '-',
                developer: 'AIFC Green Finance Centre',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Corporations, Financial Service providers, Investment Managers, Asset Owners (Other), Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Voluntary, National Sustainable Finance Strategy, Taxonomy.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: '-',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'Kazakhstan'
            },
            {
                latitude: 3.140853,
                longitude: 101.693207,
                name: 'Climate Change and Principle-based Taxonomy',
                link: 'https://www.bnm.gov.my/-/climate-change-principle-based-taxonomy',
                yearinitiated: '2021',
                mostrecentupdate: 'The most recent updates sets out five Guiding Principles (GPs) intended to help financial institutions (FIs) assess and categorize economic activities according to the extent to which they meet climate objectives and promote the transition to a low-carbon economy.',
                mandatedinlaworvoluntary: '-',
                developer: 'Bank Negara Malaysia (Central Bank of Malaysia)',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Corporations, Financial Service providers, Investment Managers, Asset Owners (Other), Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Voluntary, Taxonomy.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: '-',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'Malaysia'
            },
            {
                latitude: 47.921230,
                longitude: 106.918556,
                name: 'Mongolia Green Taxonomy',
                link: 'https://www.greenfinanceplatform.org/policies-and-regulations/mongolia-green-taxonomy',
                yearinitiated: '2019',
                mostrecentupdate: 'This update aims to “develop a nationally agreed classification framework of activities that contribute to climate change mitigation, adaptation, pollution prevention, resource conservation, and livelihood improvement in the context of green finance”. It is designed to be applied to a wide range of financial instruments including corporate lending, consumer lending, project finance, SME finance, green bonds, equity investment, insurance, credit guarantee, grants, financial advisory and technical assistance, among others. The activities identified in this version of the taxonomy will be reviewed every 3-5 years following policy shifts, scientific developments, technological changes, and new industry needs in the green finance space. It is based on 6 principles: Contribute to national policies and targets; Address environmental challenges; Cover high-emitting, key economic sectors; Align with international standards and good practices; Comply with ESG standards; Continues review and development.',
                mandatedinlaworvoluntary: '-',
                developer: 'Financial Stability Commission of Mongolia',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Corporations, Financial Service providers, Investment Managers, Asset Owners (Other), Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Voluntary, Taxonomy.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: '-',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'Mongolia'
            },
            {
                latitude: 55.751244,
                longitude: 37.618423,
                name: 'Green Taxonomy',
                link: 'http://publication.pravo.gov.ru/Document/View/0001202109240043',
                yearinitiated: '2021',
                mostrecentupdate: 'The udate had the ambition of compatibility with international best practice. It covers waste management, energy, construction, industry, transport, water supply, biodiversity, and agriculture. The energy criteria follow the 100g CO2e/kWh threshold, based on the recommendations of the Technical Expert Group (EU TEG) on sustainable finance for the EU Taxonomy of sustainable activities. It includes adaptation criteria and provides an opportunity to develop transition criteria in the future. However, it does not include do no significant harm criteria.',
                mandatedinlaworvoluntary: '-',
                developer: 'Vnesheconombank (VEB)',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Others (Exchanges etc.), Corporations, Financial Service providers, Investment Managers, Asset Owners (Other), Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Voluntary, Taxonomy.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: '-',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'Russia'
            },
            {
                latitude: 1.3521,
                longitude: 103.8198,
                name: 'Green and transition taxonomy',
                link: 'https://abs.org.sg/industry-guidelines/gfit-taxonomy-public-consultation',
                yearinitiated: '2021',
                mostrecentupdate: '2022 <br> <br> This draft initiative is one of four allocated to the Green Finance Industry Taskforce (GFIT), convened by the Monetary Authority of Singapore to accelerate the development of green finance: (i) develop a taxonomy (ii) enhance environmental risk management practices of financial institutions (iii) improve disclosures, and (iv) foster green finance solutions. Under the first focus area, the GFIT is exploring the development of a taxonomy for Singapore-based financial institutions, with particular relevance to those active across ASEAN. The GFIT held a consultation on their initial thinking around the potential development of a taxonomy which closed in March 2021. A second consultation paper was released on 12 May 2022, building on the broad support for the development of the Taxonomy reflected in the feedback received for the first consultation document, as well as key developments in the sustainability space. The second paper expands on the traffic light approach, and adds granularity to the application and thresholds for classification, supported by science and data.',
                mandatedinlaworvoluntary: '-',
                developer: 'Green Finance Industry Taskforce (GFIT)',
                objective: '-',
                linkpolicyobjectives: '.',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Corporations, Financial Service providers, Investment Managers, Asset Owners (Other), Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Voluntary, Taxonomy.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: '-',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'Singapore'
            },
            {
                latitude: -25.731340,
                longitude: 28.218370,
                name: 'South African Green Finance Taxonomy',
                link: 'https://sustainablefinanceinitiative.org.za/taxonomy/',
                yearinitiated: '2022',
                mostrecentupdate: 'This first edition of the South African Green Finance Taxonomy aims to have a range of benefits. Amongst other things, it will (i) Help the financial sector with clarity and certainty in selecting green investments in line with international best practice and South Africas national policies and priorities. (ii) Reduce financial sector risks through enhanced management of environmental and social performance. (iii) Reduce the costs associated with labelling and issuing green financial instrument. (iv) Unlock significant investment opportunities for South Africa in a broad range of green and climate-friendly assets. (v) Support regulatory and supervision oversight of the financial sector. (vi) Provide a basis for regulators to align or reference green financial products.',
                mandatedinlaworvoluntary: '-',
                developer: 'National Treasury of the republic of South Africa with the IFC, Carbon Trust and NBI.',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: 'Credit Rating Agencies, Corporations, Investment Managers, Asset Owners (Other), Asset Owners (Insurance companies), Asset Owners (Corporate pension or equivalent plans), Asset Owners (non-corporate Pension Funds or equivalent), Mandatory (including comply or explain), Taxonomy, Investor ESG disclosure, Corporate ESG disclosure.',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: '-',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'South Africa'
            },
            {
                latitude: 8.983333,
                longitude: -79.516670,
                name: 'La Taxonomía de Finanzas Sostenibles de Panamá',
                link: 'https://www.unepfi.org/publications/la-taxonomia-de-finanzas-sostenibles-de-panama/',
                yearinitiated: '2024',
                mostrecentupdate: 'Panama’s Sustainable Finance Taxonomy delineates environmentally sustainable investments, providing a framework for real-economy and financial sector players to pinpoint activities aligned with the nation’s environmental and social goals. This robust, science-based tool aims to streamline capital mobilization towards strategic investments, fostering Panama’s transition to a sustainable economy.',
                mandatedinlaworvoluntary: '-',
                developer: 'UNEP FI and EU',
                objective: '-',
                linkpolicyobjectives: '-',
                sectorscovered: '-',
                approachtoeligibility: '-',
                basedonanothertaxonomy: '-',
                Intendedtobeinteroperable: '-',
                Purpose: '-',
                Sectorclassification: '-',
                DonosignificantharmDNHS: '-',
                Socialobjectivessafeguards: '-',
                Additionalguidance: '-',
                otherusefuldocuments: '-',
                MemberofIPFS: '-',
                Biodiversity: '-',
                country: 'Panama'
            },
            // Add more taxonomies here
        ];

        function featureToGeoJSON(taxonomy) {
            return {
                'type': 'Feature',
                'properties': {
                    'name': taxonomy.name,
                    'link': taxonomy.link
                },
                'geometry': {
                    'type': 'Point',
                    'coordinates': [taxonomy.longitude, taxonomy.latitude]
                }
            };
        }
        // ... (other code)

        const popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: true,
            className: 'custom-popup' // Add this classf
        });

        // Note: Ensure the function 'filterPopupContent' is defined elsewhere in your code to handle the input search functionality.


        map.on('load', () => {
            map.addSource('esgTaxonomies', {
                'type': 'geojson',
                'data': {
                    'type': 'FeatureCollection',
                    'features': esgTaxonomies.map(taxonomy => featureToGeoJSON(taxonomy))
                }
            });
            map.addLayer({
                'id': 'taxonomy-markers',
                'type': 'circle',
                'source': 'esgTaxonomies',
                'paint': {
                    'circle-color': 'green',
                    'circle-radius': 10,
                    'circle-stroke-width': 2,
                    'circle-stroke-color': 'white'
                }
            });

            // Only keep one definition of filterPopupContent function
            function filterPopupContent(inputElement) {
                const searchValue = inputElement.value.toLowerCase();
                const contentDiv = inputElement.nextElementSibling;
                const textElements = contentDiv.querySelectorAll('.popup-text');
                textElements.forEach(element => {
                    if (searchValue) {
                        element.innerHTML = highlightText(element.textContent, searchValue);
                    } else {
                        element.innerHTML = element.textContent;
                    }
                });
            }

            map.on('movestart', () => {
                map.setFilter('taxonomy-markers', ['has', 'name', false]);
            });
            map.on('moveend', () => {
                const features = map.queryRenderedFeatures({ layers: ['taxonomy-markers'] });
                if (features) {
                    renderListings(features);
                }
            });

        });

        function setupIndividualCollapsibles(popupContent) {
            const collapsibleHeaders = popupContent.querySelectorAll('.collapsible-header');
            collapsibleHeaders.forEach(header => {
                header.addEventListener('click', function () {
                    const content = this.nextElementSibling; // Assuming content directly follows header
                    const isVisible = content.style.display === 'block';
                    content.style.display = isVisible ? 'none' : 'block';

                    // Optional: Toggle arrow direction or class
                    const arrow = this.querySelector('.collapsible-arrow');
                    arrow.textContent = isVisible ? '▼' : '▲'; // Adjust symbols or toggle class as needed
                });
            });
        }

        function setupSearchInput(popupContent) {
            // Find the search input within the popup content
            const searchInput = popupContent.querySelector('input[type="text"]');

            // Attach an event listener to handle the input event
            searchInput.addEventListener('input', function () {
                // Call the filter function with the current value of the input and the popup content
                filterPopupContent(this.value, popupContent);
            });
        }

        function convertUrlsToLinks(text) {
            const urlRegex = /(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
            return text.replace(urlRegex, function (url) {
                return '<a href="' + url + '" target="_blank">' + url + '</a>';
            });
        }

        map.on('click', 'taxonomy-markers', (e) => {
            const taxonomyName = e.features[0].properties.name;
            const taxonomy = esgTaxonomies.find(item => item.name === taxonomyName);
            if (!taxonomy) return;

            const popupContent = document.createElement('div');
            popupContent.innerHTML = `
            <div class="popup-flex-container">
                <div class="search-bar-container" style="position: sticky; top: 0; z-index: 2; background: white;">
                    <input type="text" placeholder="Search...">
                </div>
                <div class="popup-content-details" style="overflow-y: auto; max-height: calc(100% - 60px);"> <!-- Adjust max-height as needed -->    
                <div class="popup-content-details">
                    <strong>Taxonomy:</strong> <span class="popup-text">${taxonomy.name}</span><br><br>
                    <strong>Year Initiated:</strong> <span class="popup-text">${taxonomy.yearinitiated}</span><br><br>
                    <button id="expand-all">Expand All</button>
                    <button id="collapse-all">Collapse All</button><br><br>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Developer</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.developer}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Mandated in Law or Voluntary</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.mandatedinlaworvoluntary}</p>
                        </div>
                    </div>    
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Purpose</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.Purpose}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Objective</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.objective}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Link Policy Objectives</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.linkpolicyobjectives}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Approach to Elegibility</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.approachtoeligibility}</p>
                        </div>
                    </div>                    
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Sectors Covered</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.sectorscovered}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Social Objectives / Safeguards</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.Socialobjectivessafeguards}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Do No Significant Harm (DNSH)</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.DonosignificantharmDNHS}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Intended to be interoperable</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.Intendedtobeinteroperable}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Member of the IPFS</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.MemberofIPFS}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Taxonomy Source</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.link}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Additional guidance</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.Additionalguidance}</p>
                        </div>
                    </div>
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <span>Other useful documents</span>
                            <span class="collapsible-arrow">&#9660;</span>
                        </div>
                        <div class="collapsible-content">
                            <p>${taxonomy.otherusefuldocuments}</p>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        `;
            // Convert URLs to links
            popupContent.innerHTML = convertUrlsToLinks(popupContent.innerHTML);

            // Setup collapsibles and search functionality
            setupIndividualCollapsibles(popupContent);
            // Set up search input functionality
            setupSearchInput(popupContent);

            // Show the popup
            new mapboxgl.Popup({
                closeButton: false,
                closeOnClick: true
            })
                .setLngLat(e.lngLat)
                .setDOMContent(popupContent)
                .addTo(map);

            // Generate and insert popup content with search functionality
            function generatePopupContent(taxonomy) {
                const popupContent = document.createElement('div');
                popupContent.innerHTML = `...`; // Existing HTML content goes here

                // Add a search input box to the popup content
                const searchInput = document.createElement('input');
                searchInput.type = 'text';
                searchInput.placeholder = 'Search...';
                searchInput.oninput = function () {
                    // Filter and highlight popup content based on search term
                    const term = this.value.trim();
                    const textElements = popupContent.querySelectorAll('.popup-text');
                    textElements.forEach(el => {
                        el.innerHTML = highlightText(el.textContent, term);
                    });
                };

                // Add the search input box at the beginning of the popup content
                popupContent.insertBefore(searchInput, popupContent.firstChild);

                return popupContent;
            }

            function convertUrlsToLinks(text) {
                const urlRegex = /(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
                return text.replace(urlRegex, function (url) {
                    return '<a href="' + url + '" target="_blank">' + url + '</a>';
                });
            }

            map.on('click', 'taxonomy-markers', (e) => {
                // ... (other code to generate popup content)

                const popupContent = document.createElement('div');
                popupContent.innerHTML =
                    // Set up search input functionality
                    setupSearchInput(popupContent);

                // Show the popup
                new mapboxgl.Popup({
                    closeButton: false,
                    closeOnClick: true
                })
                    .setLngLat(e.lngLat)
                    .setDOMContent(popupContent)
                    .addTo(map);
            });

            setupIndividualCollapsibles(popupContent);

            // Immediately append popupContent to the popup to ensure it's part of the DOM
            new mapboxgl.Popup({
                closeButton: false,
                closeOnClick: true
            })
                .setLngLat(e.lngLat)
                .setDOMContent(popupContent)
                .addTo(map);

            // After the popup is added to the map, find and setup the buttons
            setupPopupButtons(popupContent);
        });

        function setupPopupButtons(popupContent) {
            const expandAllBtn = popupContent.querySelector('#expand-all');
            const collapseAllBtn = popupContent.querySelector('#collapse-all');

            expandAllBtn.addEventListener('click', function () {
                toggleCollapsible(popupContent, true); // Expand all
            });

            collapseAllBtn.addEventListener('click', function () {
                toggleCollapsible(popupContent, false); // Collapse all
            });

            // Setup individual collapsible sections
            setupIndividualCollapsibles(popupContent);
        }

        function toggleCollapsible(popupContent, expand) {
            const collapsibles = popupContent.querySelectorAll('.collapsible-content');
            const arrows = popupContent.querySelectorAll('.collapsible-arrow');
            collapsibles.forEach((collapsible, index) => {
                collapsible.style.display = expand ? 'block' : 'none';
                arrows[index].textContent = expand ? '▲' : '▼'; // Adjust arrow symbol
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Assuming there are buttons with IDs 'expand-all' and 'collapse-all'
            const expandAllButton = document.getElementById('expand-all');
            const collapseAllButton = document.getElementById('collapse-all');

            // Function to expand all collapsible elements
            function expandAll() {
                document.querySelectorAll('.collapsible-content').forEach(function (content) {
                    content.style.display = 'block'; // Show content
                });
            }

            document.querySelector('input[type="text"]').addEventListener('input', function () {
                filterPopupContent(this);
            });


            // Function to collapse all collapsible elements
            function collapseAll() {
                document.querySelectorAll('.collapsible-content').forEach(function (content) {
                    content.style.display = 'none'; // Hide content
                });
            }

            // Ensure this function is called after the popup is added to the map and popupContent is part of the DOM
            function setupCollapsibles(popupContent) {
                const collapsibleHeaders = popupContent.querySelectorAll('.collapsible-header');
                collapsibleHeaders.forEach(header => {
                    header.addEventListener('click', function () {
                        const content = this.nextElementSibling; // Assuming content directly follows header
                        const isVisible = content.style.display === 'block';
                        content.style.display = isVisible ? 'none' : 'block';

                        // Optional: Toggle arrow direction or class
                        const arrow = this.querySelector('.collapsible-arrow');
                        arrow.textContent = isVisible ? '▼' : '▲'; // Adjust symbols or toggle class as needed
                    });
                });
            }

            // This function needs to be called after the popup content is fully loaded into the DOM.

            // Add event listeners to the buttons
            expandAllButton.addEventListener('click', expandAll);
            collapseAllButton.addEventListener('click', collapseAll);
        });

        // Use event delegation to handle events for dynamic popup elements
        document.addEventListener('click', function (event) {
            if (event.target.matches('.collapsible-header')) {
                // Handle collapsible toggling
                const header = event.target;
                const content = header.nextElementSibling;
                content.style.display = content.style.display === 'block' ? 'none' : 'block';
            } else if (event.target.matches('#expand-all')) {
                // Handle expanding all collapsibles
                const popupContent = event.target.closest('.popup-content-details');
                popupContent.querySelectorAll('.collapsible-content').forEach(content => {
                    content.style.display = 'block';
                });
            } else if (event.target.matches('#collapse-all')) {
                // Handle collapsing all collapsibles
                const popupContent = event.target.closest('.popup-content-details');
                popupContent.querySelectorAll('.collapsible-content').forEach(content => {
                    content.style.display = 'none';
                });
            }
        });

    </script>

</body>
